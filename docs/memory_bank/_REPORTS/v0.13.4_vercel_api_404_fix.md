# Vercel API 404 Fix Report (v0.13.4)

**Date**: 2025-12-25
**Problem**: Vercel returns `404` for API routes (`/api/...`).
**Root Cause**: Incorrect Root Directory setting in Vercel. The codebase is a monorepo, but Vercel is likely building from root or incorrectly configured.

## 1. Required Vercel Project Settings (Action Required)
Go to **Vercel Dashboard > Settings > General**. Change the following:

- **Root Directory**: `apps/pilot-web` (Essential for monorepo separation)
- **Framework Preset**: `Next.js`
- **Build Command**: `next build` (Or leave default if Root Dir is set)
- **Install Command**: `npm install` (Or leave default)

**Why?**: Setting the Root Directory ensures Vercel treats `apps/pilot-web` as the Next.js application root, correctly mapping `app/api/*` to function routes.

## 2. Environment Variables Check
Ensure these are set in **Settings > Environment Variables**:
1. `NEXT_PUBLIC_SUPABASE_URL`
2. `NEXT_PUBLIC_SUPABASE_ANON_KEY`

## 3. Verification Protocol
After updating settings and triggering a redeploy (pushing this commit should trigger it if Git is connected), run:

```bash
# 1. Health Check (Immediate)
curl -i https://leuniversita.vercel.app/api/health
# Expect: HTTP/2 200 OK, {"ok":true, ...}

# 2. Remote Smoke Test (Full)
bash scripts/test/smoke_v2_remote.sh
```

## 4. One-Shot Fix Logic
This release includes:
- `/api/health`: A dedicated, auth-free route to verify connectivity.
- Updated Smoke Script: Checks health first to fail fast.
