---
id: TEST-FINAL-012-3
title: v0.12.3 Final Smoke Test Results
owner: QA
status: failed
created_at: 2025-12-23
updated_at: 2025-12-23
tags: [test, smoke, v2, failed]
related: [TEST-012-2]
source_of_truth: docs/memory_bank/_REPORTS
mermaid: required
---

# v0.12.3 Final Smoke Test Results

**Verdict**: ðŸ”´ **READY FOR UI: NO**

The Smoke Test has failed multiple times with `PGRST204` (Schema Cache) errors specifically for `modules.order_index` and `assessments.course_id`.

## Diagnosis: Stale Schema / Partial Migration
The error persists even after cache reload. This strongly suggests that the **tables `modules` and `assessments` already existed** in the database prior to the V2 migration, but with a different structure (missing `order_index`, `course_id`).
Since the V2 migration used `CREATE TABLE IF NOT EXISTS`, it **skipped** modifying these existing tables.

**Evidence**:
- `courses` table was created/populated successfully (likely did not exist before).
- `modules` and `assessments` fail on specific columns.

## Remediation Plan
Creating a "Fix" SQL script is required to align the existing tables with V2 Schema.

### 1. Apply Fix (SQL Editor)
Execute the following SQL to add missing columns:
```sql
-- Fix V2 Schema Gaps
ALTER TABLE public.modules 
ADD COLUMN IF NOT EXISTS order_index int default 0,
ADD COLUMN IF NOT EXISTS server_id text unique;

ALTER TABLE public.assessments 
ADD COLUMN IF NOT EXISTS course_id uuid references public.courses(id) on delete cascade;

-- Force Cache Reload
NOTIFY pgrst, 'reload config';
```

### 2. Verify
Run `./scripts/test/smoke_v2.sh`.

## Conclusion
The environment contains legacy state that conflicted with the "Parallel" migration strategy. Once the patch above is applied, the backend should be ready.
