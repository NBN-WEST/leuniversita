---
id: TEST-FINAL-012-3
title: v0.12.3 Final Smoke Test Results
owner: QA
status: failed
created_at: 2025-12-23
updated_at: 2025-12-23
tags: [test, smoke, v2, failed]
related: [TEST-012-2]
source_of_truth: docs/memory_bank/_REPORTS
mermaid: required
---

# v0.12.3 Final Smoke Test Results

**Verdict**: üî¥ **READY FOR UI: NO**

The Verification process encountered a **Hostile Legacy Schema** that prevents data seeding and V2 verification. The environment relies on a "Hybrid" state where V2 tables (`courses`) coexist with legacy tables (`modules`, `assessments`, `questions`) that have undisclosed constraints.

## 1. Diagnostics Summary
We performed 12 iterations of Seed Script patching to reverse-engineer the legacy constraints.

### Identified Legacy Constraints
| Table | Column | Constraint | Status |
|---|---|---|---|
| `modules` | `order_index` | Missing Column | ‚ùå Requires SQL Alter |
| `modules` | `exam_id` | NOT NULL | ‚ö†Ô∏è Patched (Dummy) |
| `assessments` | `title` | NOT NULL | ‚ö†Ô∏è Patched |
| `assessments` | `format` | NOT NULL | ‚ö†Ô∏è Patched |
| `assessments` | `num_items` | NOT NULL | ‚ö†Ô∏è Patched |
| `topics` | `exam_id` | NOT NULL | ‚ö†Ô∏è Patched |
| `questions` | `module_id` | NOT NULL | ‚ö†Ô∏è Patched |
| `questions` | `topic_id` | NOT NULL | ‚ö†Ô∏è Patched |
| `questions` | `difficulty` | CHECK CONSTRAINT | ‚ùå **FAIL** (Cannot guess valid value) |

### 2. Blockers
1. **Schema Cache**: Persistent `PGRST204` errors confirm Supabase cache is stale or columns are missing despite "Migration" attempts.
2. **Hidden Constraints**: `questions_difficulty_check` rejects all standard values (`1`, `0`, `'Easy'`, `'Facile'`, etc.). Without `DATABASE_URL` or Schema inspection access, this is unresolvable via script.

## 3. Remediation Plan (Infrastructure)
The current "Patch & Pray" approach is unsustainable. The following Infrastructure actions are required:

1. **Clean Slate (Recommended)**:
   - Drop all tables in Staging.
   - Re-run Migration V1 + V2 cleanly.
2. **Or Full Migration Access**:
   - Provide `DATABASE_URL` to QA to allow running `pg_dump -s` and debugging constraints.

## Conclusion
The backend software (Edge Functions, API Routes) is theoretically sound, but the **Data Layer is broken**. UI integration cannot proceed until a predictable Database environment is established.
