# Vercel Build & Routing Definitive Fix (v0.13.7)

**Date**: 2025-12-25
**Status**: VERIFIED GREEN (Local)

## 1. Audit & Fixes Executed
| Category | Action | Result |
| :--- | :--- | :--- |
| **Dependencies** | Synced `package-lock.json` in `apps/pilot-web`. | ✅ Modules Found |
| **Auth** | Switched from `createClient` / `auth-helpers` to `@supabase/ssr` (`createBrowserClient`) in `results`, `diagnostic`, and `progress`. | ✅ Standardized |
| **Types** | Extracted `ResultData` from `results/page.tsx` to `types/results.ts`. | ✅ JSX Clean |
| **Routing** | Confirmed `api` routes align with Next.js 16 (Dynamic `params`). | ✅ Built Successfully |

## 2. Monorepo Configuration Note
To ensure Vercel builds correctly without manual root setting, `vercel.json` is **not** the comprehensive solution because modern Vercel ignores `builds` usage when Git is connected.
**The definitive fix remains the Vercel Project Setting**:
- **Root Directory**: `apps/pilot-web` (Must be set in UI).

## 3. Verification Protocol
1.  **Deployment**: Push this commit.
2.  **Health Check**:
    ```bash
    curl -I https://leuniversita.vercel.app/api/health
    # Expect: 200 OK
    ```
3.  **Smoke Test**:
    ```bash
    bash scripts/test/smoke_v2_remote.sh
    ```

## 4. Dependencies
- Removed: `auth-helpers` usage (cleanup pending final verification).
- Added: `@supabase/ssr` heavily used.
